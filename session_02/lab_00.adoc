
= Lab 0 - OIDC-UAA Integration, Accessing PKS environment, Using PKS CLI, Cluster Creation

Ensure that UAA is enabled as an OIDC provider in Ops Manager -> Enterprise PKS tile. See screenshot below.


image::../common/images/enable_uaa_oidc_provider.png[]  

This lab is configured to use UAA as the identity provider. This can also work with using LDAP as the identity provider. Follow these steps to create UAA users, group and map it to PKS group so that we can allow users to perform the role of PKS cluster admin or PKS cluster manager.

== Log in as UAA admin

. SSH into your PKS Ops Manager VM. This lab is conducted with PKS running on GCP. You should see a screen similar to the one below:
+
image::../common/images/opsman-ssh-gcp.png[]  

. Target your PKS UAA API endpoint with the following command. Replace the api endpoint with your PKS installation's PKS API endpoint.

----
uaac target https://api.pks.pcf4labs.com:8443 --ca-cert /var/tempest/workspaces/default/root_ca_certificate
----

You should see a response similar to this one:
----
Target: https://api.pks.pcf4labs.com:8443
Context: admin, from client admin
----
. Now, we will get an access token for the 'admin' user so that we can create custom UAA groups and UAA users (cluster admin, cluster managers and developers). You will need the 'admin' client secret for retrieving the access token. You can find the client secret in Ops Manager -> Enterprise PKS -> Credentials -> Pks Uaa Management Admin Client. (See screenshot below).
+
image::../common/images/uaa-mgmt-admin-client.png[]




